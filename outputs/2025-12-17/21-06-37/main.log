[2025-12-17 21:06:37,665][__main__][INFO] - Using device: cuda
[2025-12-17 21:06:37,668][__main__][INFO] - ====================================================================================================
[2025-12-17 21:06:37,668][__main__][INFO] - GENEFORMER PERTURBATION PIPELINE
[2025-12-17 21:06:37,668][__main__][INFO] - ====================================================================================================
[2025-12-17 21:06:37,668][__main__][INFO] - Experiment: geneformer_perturbation
[2025-12-17 21:06:37,673][__main__][INFO] - 
Configuration:
seed: 42
verbose: true
model:
  name: gf-12L-38M-i4096
  batch_size: 32
  max_length: 2048
  device: cuda:0
data:
  pertpy_data_identifier: norman_2019
  condition_filter: control
  gene_names_column: index
  use_raw_counts: false
  preprocess: true
  normalize: true
  filter_genes: true
  min_genes: 200
  min_cells: 3
  max_cells: 1000
  max_genes: 100
perturbation:
  gene_list: null
  num_genes: 10
  perturbation_type: knockout
  selection_method: top_expressed
  perturbation_strength: 2.0
optimization:
  methods:
  - distributed
  batching:
    enabled: true
    batch_size_multiplier: 2
    use_dataloader: true
    num_workers: 4
    pin_memory: true
  quantization:
    enabled: true
    dtype: qint8
    quantize_layers:
    - torch.nn.Linear
    dynamic: true
  onnx:
    enabled: true
    opset_version: 14
    optimize: true
    use_gpu: true
    precision: FP16
  distributed:
    enabled: true
    backend: nccl
    world_size: null
    use_data_parallel: true
output:
  dir: outputs
  save_outputs: true
  compression: null
  precision: float32
  save_embeddings: true
  save_perturbations: true
  save_metadata: true
  save_cell_ids: true
  save_gene_names: true
  save_detailed_comparisons: true
  log_level: INFO
  log_to_file: true
  log_file: pipeline.log
hardware:
  device: auto
  mixed_precision: false
  cudnn_benchmark: true
  empty_cache_between_methods: true
  max_memory_gb: null
experiment:
  name: geneformer_perturbation
  tags: []
  notes: ''
reproducibility:
  deterministic: true
  benchmark: false
advanced:
  gradient_checkpointing: false
  compile_model: false
  compile_backend: inductor
  continue_on_error: true
  max_retries: 3
validation:
  min_correlation: 0.95
  max_mse: 0.01
  warn_on_threshold: true
  check_nan: true
  check_inf: true

[2025-12-17 21:06:37,673][__main__][INFO] - Loading Geneformer model...
[2025-12-17 21:06:37,674][helical.utils.downloader][INFO] - Downloading 'geneformer/v2/gene_median_dictionary.pkl'
[2025-12-17 21:06:37,674][helical.utils.downloader][INFO] - Starting to download: 'https://helicalpackage.s3.eu-west-2.amazonaws.com/geneformer/v2/gene_median_dictionary.pkl'
[2025-12-17 21:06:38,576][helical.utils.downloader][INFO] - File saved to: '/root/.cache/helical/models/geneformer/v2/gene_median_dictionary.pkl'
[2025-12-17 21:06:38,576][helical.utils.downloader][INFO] - Downloading 'geneformer/v2/token_dictionary.pkl'
[2025-12-17 21:06:38,576][helical.utils.downloader][INFO] - Starting to download: 'https://helicalpackage.s3.eu-west-2.amazonaws.com/geneformer/v2/token_dictionary.pkl'
[2025-12-17 21:06:38,812][helical.utils.downloader][INFO] - File saved to: '/root/.cache/helical/models/geneformer/v2/token_dictionary.pkl'
[2025-12-17 21:06:38,812][helical.utils.downloader][INFO] - Downloading 'geneformer/v2/ensembl_mapping_dict.pkl'
[2025-12-17 21:06:38,813][helical.utils.downloader][INFO] - Starting to download: 'https://helicalpackage.s3.eu-west-2.amazonaws.com/geneformer/v2/ensembl_mapping_dict.pkl'
[2025-12-17 21:06:39,132][helical.utils.downloader][INFO] - File saved to: '/root/.cache/helical/models/geneformer/v2/ensembl_mapping_dict.pkl'
[2025-12-17 21:06:39,132][helical.utils.downloader][INFO] - Downloading 'geneformer/v2/gf-12L-38M-i4096/config.json'
[2025-12-17 21:06:39,132][helical.utils.downloader][INFO] - Starting to download: 'https://helicalpackage.s3.eu-west-2.amazonaws.com/geneformer/v2/gf-12L-38M-i4096/config.json'
[2025-12-17 21:06:39,341][helical.utils.downloader][INFO] - File saved to: '/root/.cache/helical/models/geneformer/v2/gf-12L-38M-i4096/config.json'
[2025-12-17 21:06:39,341][helical.utils.downloader][INFO] - Downloading 'geneformer/v2/gf-12L-38M-i4096/training_args.bin'
[2025-12-17 21:06:39,341][helical.utils.downloader][INFO] - Starting to download: 'https://helicalpackage.s3.eu-west-2.amazonaws.com/geneformer/v2/gf-12L-38M-i4096/training_args.bin'
[2025-12-17 21:06:39,536][helical.utils.downloader][INFO] - File saved to: '/root/.cache/helical/models/geneformer/v2/gf-12L-38M-i4096/training_args.bin'
[2025-12-17 21:06:39,536][helical.utils.downloader][INFO] - Downloading 'geneformer/v2/gf-12L-38M-i4096/model.safetensors'
[2025-12-17 21:06:39,536][helical.utils.downloader][INFO] - Starting to download: 'https://helicalpackage.s3.eu-west-2.amazonaws.com/geneformer/v2/gf-12L-38M-i4096/model.safetensors'
[2025-12-17 21:06:43,853][helical.utils.downloader][INFO] - File saved to: '/root/.cache/helical/models/geneformer/v2/gf-12L-38M-i4096/model.safetensors'
[2025-12-17 21:06:48,288][helical.models.geneformer.model][INFO] - Model finished initializing.
[2025-12-17 21:06:48,288][helical.models.geneformer.model][INFO] - 'gf-12L-38M-i4096' model is in 'eval' mode, on device 'cuda:0' with embedding mode 'cell'.
[2025-12-17 21:06:48,289][__main__][INFO] - Model loaded: gf-12L-38M-i4096
[2025-12-17 21:06:48,290][__main__][INFO] - Loading data: norman_2019
[2025-12-17 21:07:59,603][__main__][INFO] - Loaded 11835 cells, 19018 genes
[2025-12-17 21:07:59,603][__main__][INFO] - Preprocessing data...
[2025-12-17 21:08:00,040][py.warnings][WARNING] - /opt/conda/lib/python3.10/site-packages/scanpy/preprocessing/_simple.py:176: ImplicitModificationWarning: Trying to modify attribute `.obs` of view, initializing view as actual.
  adata.obs["n_genes"] = number

[2025-12-17 21:08:02,113][__main__][INFO] - After filtering: 11835 cells, 18215 genes
[2025-12-17 21:08:05,440][__main__][INFO] - Data normalized
[2025-12-17 21:08:05,446][__main__][INFO] - Subsetted to 1000 cells for testing
[2025-12-17 21:08:05,448][__main__][INFO] - Subsetted to 100 genes for testing
[2025-12-17 21:08:05,448][__main__][INFO] - Tokenizing data...
[2025-12-17 21:08:05,448][helical.models.geneformer.model][INFO] - Processing data for Geneformer.
[2025-12-17 21:08:05,448][py.warnings][WARNING] - /opt/conda/lib/python3.10/site-packages/helical/models/base_models.py:88: ImplicitModificationWarning: Trying to modify attribute `.var` of view, initializing view as actual.
  adata.var["index"] = adata.var.index

[2025-12-17 21:08:05,460][helical.utils.downloader][INFO] - Downloading 'hsapiens_pybiomart.csv'
[2025-12-17 21:08:05,460][helical.utils.downloader][INFO] - Starting to download: 'https://helicalpackage.s3.eu-west-2.amazonaws.com/hsapiens_pybiomart.csv'
[2025-12-17 21:08:06,382][helical.utils.downloader][INFO] - File saved to: '/root/.cache/helical/models/hsapiens_pybiomart.csv'
[2025-12-17 21:08:06,447][helical.utils.mapping][INFO] - Mapped 68 / 100 genes to Ensembl IDs.
[2025-12-17 21:08:06,464][helical.models.geneformer.geneformer_tokenizer][INFO] - AnnData object with n_obs × n_vars = 1000 × 100
    obs: 'guide_identity', 'read_count', 'UMI_count', 'coverage', 'gemgroup', 'good_coverage', 'number_of_cells', 'guide_AHR', 'guide_ARID1A', 'guide_ARRDC3', 'guide_ATL1', 'guide_BAK1', 'guide_BCL2L11', 'guide_BCORL1', 'guide_BPGM', 'guide_C19orf26', 'guide_C3orf72', 'guide_CBFA2T3', 'guide_CBL', 'guide_CDKN1A', 'guide_CDKN1B', 'guide_CDKN1C', 'guide_CEBPA', 'guide_CEBPB', 'guide_CEBPE', 'guide_CELF2', 'guide_CITED1', 'guide_CKS1B', 'guide_CLDN6', 'guide_CNN1', 'guide_CNNM4', 'guide_COL1A1', 'guide_COL2A1', 'guide_CSRNP1', 'guide_DLX2', 'guide_DUSP9', 'guide_EGR1', 'guide_ELMSAN1', 'guide_ETS2', 'guide_FEV', 'guide_FOSB', 'guide_FOXA1', 'guide_FOXA3', 'guide_FOXF1', 'guide_FOXL2', 'guide_FOXO4', 'guide_GLB1L2', 'guide_HES7', 'guide_HK2', 'guide_HNF4A', 'guide_HOXA13', 'guide_HOXB9', 'guide_HOXC13', 'guide_IER5L', 'guide_IGDCC3', 'guide_IKZF3', 'guide_IRF1', 'guide_ISL2', 'guide_JUN', 'guide_KIAA1804', 'guide_KIF18B', 'guide_KIF2C', 'guide_KLF1', 'guide_KMT2A', 'guide_LHX1', 'guide_LYL1', 'guide_MAML2', 'guide_MAP2K3', 'guide_MAP2K6', 'guide_MAP4K3', 'guide_MAP4K5', 'guide_MAP7D1', 'guide_MAPK1', 'guide_MEIS1', 'guide_MIDN', 'guide_NCL', 'guide_NIT1', 'guide_OSR2', 'guide_PLK4', 'guide_POU3F2', 'guide_PRDM1', 'guide_PRTG', 'guide_PTPN1', 'guide_PTPN12', 'guide_PTPN13', 'guide_PTPN9', 'guide_RHOXF2', 'guide_RREB1', 'guide_RUNX1T1', 'guide_S1PR2', 'guide_SAMD1', 'guide_SET', 'guide_SGK1', 'guide_SLC38A2', 'guide_SLC4A1', 'guide_SLC6A9', 'guide_SNAI1', 'guide_SPI1', 'guide_STIL', 'guide_TBX2', 'guide_TBX3', 'guide_TGFBR2', 'guide_TMSB4X', 'guide_TP73', 'guide_TSC22D1', 'guide_UBASH3A', 'guide_UBASH3B', 'guide_ZBTB1', 'guide_ZBTB10', 'guide_ZBTB25', 'guide_ZC3HAV1', 'guide_ZNF318', 'guide_ids', 'n_genes', 'n_genes_by_counts', 'total_counts', 'total_counts_mt', 'pct_counts_mt', 'leiden', 'perturbation_name', 'perturbation_type', 'perturbation_value', 'perturbation_unit'
    var: 'index', 'n_cells', 'mt', 'n_cells_by_counts', 'mean_counts', 'pct_dropout_by_counts', 'total_counts', 'highly_variable', 'means', 'dispersions', 'dispersions_norm', 'ensembl_id', 'ensembl_id_collapsed'
    uns: 'doi', 'hvg', 'leiden', 'neighbors', 'pca', 'preprocessing_nb_link', 'umap', 'log1p'
    obsm: 'X_pca', 'X_umap'
    varm: 'PCs'
    layers: 'counts'
    obsp: 'connectivities', 'distances' has no column attribute 'filter_pass'; tokenizing all cells.
[2025-12-17 21:08:06,597][helical.models.geneformer.geneformer_tokenizer][INFO] - Creating dataset.
[2025-12-17 21:08:06,616][helical.models.geneformer.model][INFO] - Successfully processed the data for Geneformer.
[2025-12-17 21:08:06,617][__main__][INFO] - Tokenization complete
[2025-12-17 21:08:06,617][__main__][INFO] - Selected 10 genes using method: top_expressed
[2025-12-17 21:08:06,617][__main__][INFO] - 
====================================================================================================
[2025-12-17 21:08:06,617][__main__][INFO] - Running BASELINE (no optimization)...
[2025-12-17 21:08:06,620][__main__][INFO] - Extracting embeddings...
[2025-12-17 21:08:06,620][helical.models.geneformer.model][INFO] - Started getting embeddings:
[2025-12-17 21:08:06,620][helical.models.geneformer.geneformer_utils][WARNING] - CLS token present in token dictionary, excluding from average.
[2025-12-17 21:08:06,620][helical.models.geneformer.geneformer_utils][WARNING] - EOS token present in token dictionary, excluding from average.
[2025-12-17 21:08:08,401][helical.models.geneformer.model][INFO] - Finished getting embeddings.
[2025-12-17 21:08:08,401][__main__][INFO] - Extracted embeddings shape: (1000, 512)
[2025-12-17 21:08:08,401][__main__][INFO] - Performing perturbation on 10 genes...
[2025-12-17 21:08:08,401][__main__][INFO] - Perturbing gene: UBE2J2 (type: knockout)
[2025-12-17 21:08:08,401][__main__][WARNING] - Using manual perturbation for UBE2J2
[2025-12-17 21:08:08,404][py.warnings][WARNING] - /opt/conda/lib/python3.10/site-packages/scipy/sparse/_index.py:151: SparseEfficiencyWarning: Changing the sparsity structure of a csr_matrix is expensive. lil_matrix is more efficient.
  self._set_arrayXarray(i, j, x)

[2025-12-17 21:08:08,409][helical.models.geneformer.model][INFO] - Processing data for Geneformer.
[2025-12-17 21:08:08,763][helical.utils.mapping][INFO] - Mapped 68 / 100 genes to Ensembl IDs.
[2025-12-17 21:08:08,782][helical.models.geneformer.geneformer_tokenizer][INFO] - AnnData object with n_obs × n_vars = 1000 × 100
    obs: 'guide_identity', 'read_count', 'UMI_count', 'coverage', 'gemgroup', 'good_coverage', 'number_of_cells', 'guide_AHR', 'guide_ARID1A', 'guide_ARRDC3', 'guide_ATL1', 'guide_BAK1', 'guide_BCL2L11', 'guide_BCORL1', 'guide_BPGM', 'guide_C19orf26', 'guide_C3orf72', 'guide_CBFA2T3', 'guide_CBL', 'guide_CDKN1A', 'guide_CDKN1B', 'guide_CDKN1C', 'guide_CEBPA', 'guide_CEBPB', 'guide_CEBPE', 'guide_CELF2', 'guide_CITED1', 'guide_CKS1B', 'guide_CLDN6', 'guide_CNN1', 'guide_CNNM4', 'guide_COL1A1', 'guide_COL2A1', 'guide_CSRNP1', 'guide_DLX2', 'guide_DUSP9', 'guide_EGR1', 'guide_ELMSAN1', 'guide_ETS2', 'guide_FEV', 'guide_FOSB', 'guide_FOXA1', 'guide_FOXA3', 'guide_FOXF1', 'guide_FOXL2', 'guide_FOXO4', 'guide_GLB1L2', 'guide_HES7', 'guide_HK2', 'guide_HNF4A', 'guide_HOXA13', 'guide_HOXB9', 'guide_HOXC13', 'guide_IER5L', 'guide_IGDCC3', 'guide_IKZF3', 'guide_IRF1', 'guide_ISL2', 'guide_JUN', 'guide_KIAA1804', 'guide_KIF18B', 'guide_KIF2C', 'guide_KLF1', 'guide_KMT2A', 'guide_LHX1', 'guide_LYL1', 'guide_MAML2', 'guide_MAP2K3', 'guide_MAP2K6', 'guide_MAP4K3', 'guide_MAP4K5', 'guide_MAP7D1', 'guide_MAPK1', 'guide_MEIS1', 'guide_MIDN', 'guide_NCL', 'guide_NIT1', 'guide_OSR2', 'guide_PLK4', 'guide_POU3F2', 'guide_PRDM1', 'guide_PRTG', 'guide_PTPN1', 'guide_PTPN12', 'guide_PTPN13', 'guide_PTPN9', 'guide_RHOXF2', 'guide_RREB1', 'guide_RUNX1T1', 'guide_S1PR2', 'guide_SAMD1', 'guide_SET', 'guide_SGK1', 'guide_SLC38A2', 'guide_SLC4A1', 'guide_SLC6A9', 'guide_SNAI1', 'guide_SPI1', 'guide_STIL', 'guide_TBX2', 'guide_TBX3', 'guide_TGFBR2', 'guide_TMSB4X', 'guide_TP73', 'guide_TSC22D1', 'guide_UBASH3A', 'guide_UBASH3B', 'guide_ZBTB1', 'guide_ZBTB10', 'guide_ZBTB25', 'guide_ZC3HAV1', 'guide_ZNF318', 'guide_ids', 'n_genes', 'n_genes_by_counts', 'total_counts', 'total_counts_mt', 'pct_counts_mt', 'leiden', 'perturbation_name', 'perturbation_type', 'perturbation_value', 'perturbation_unit'
    var: 'index', 'n_cells', 'mt', 'n_cells_by_counts', 'mean_counts', 'pct_dropout_by_counts', 'total_counts', 'highly_variable', 'means', 'dispersions', 'dispersions_norm', 'ensembl_id', 'ensembl_id_collapsed'
    uns: 'doi', 'hvg', 'leiden', 'neighbors', 'pca', 'preprocessing_nb_link', 'umap', 'log1p'
    obsm: 'X_pca', 'X_umap'
    varm: 'PCs'
    layers: 'counts'
    obsp: 'connectivities', 'distances' has no column attribute 'filter_pass'; tokenizing all cells.
[2025-12-17 21:08:08,916][helical.models.geneformer.geneformer_tokenizer][INFO] - Creating dataset.
[2025-12-17 21:08:08,940][helical.models.geneformer.model][INFO] - Successfully processed the data for Geneformer.
[2025-12-17 21:08:08,940][__main__][INFO] - Extracting embeddings...
[2025-12-17 21:08:08,941][helical.models.geneformer.model][INFO] - Started getting embeddings:
[2025-12-17 21:08:08,941][helical.models.geneformer.geneformer_utils][WARNING] - CLS token present in token dictionary, excluding from average.
[2025-12-17 21:08:08,941][helical.models.geneformer.geneformer_utils][WARNING] - EOS token present in token dictionary, excluding from average.
[2025-12-17 21:08:09,637][helical.models.geneformer.model][INFO] - Finished getting embeddings.
[2025-12-17 21:08:09,637][__main__][INFO] - Extracted embeddings shape: (1000, 512)
[2025-12-17 21:08:09,637][__main__][INFO] - Perturbing gene: SDF4 (type: knockout)
[2025-12-17 21:08:09,637][__main__][WARNING] - Using manual perturbation for SDF4
[2025-12-17 21:08:09,639][py.warnings][WARNING] - /opt/conda/lib/python3.10/site-packages/scipy/sparse/_index.py:151: SparseEfficiencyWarning: Changing the sparsity structure of a csr_matrix is expensive. lil_matrix is more efficient.
  self._set_arrayXarray(i, j, x)

[2025-12-17 21:08:09,644][helical.models.geneformer.model][INFO] - Processing data for Geneformer.
[2025-12-17 21:08:09,991][helical.utils.mapping][INFO] - Mapped 68 / 100 genes to Ensembl IDs.
[2025-12-17 21:08:10,008][helical.models.geneformer.geneformer_tokenizer][INFO] - AnnData object with n_obs × n_vars = 1000 × 100
    obs: 'guide_identity', 'read_count', 'UMI_count', 'coverage', 'gemgroup', 'good_coverage', 'number_of_cells', 'guide_AHR', 'guide_ARID1A', 'guide_ARRDC3', 'guide_ATL1', 'guide_BAK1', 'guide_BCL2L11', 'guide_BCORL1', 'guide_BPGM', 'guide_C19orf26', 'guide_C3orf72', 'guide_CBFA2T3', 'guide_CBL', 'guide_CDKN1A', 'guide_CDKN1B', 'guide_CDKN1C', 'guide_CEBPA', 'guide_CEBPB', 'guide_CEBPE', 'guide_CELF2', 'guide_CITED1', 'guide_CKS1B', 'guide_CLDN6', 'guide_CNN1', 'guide_CNNM4', 'guide_COL1A1', 'guide_COL2A1', 'guide_CSRNP1', 'guide_DLX2', 'guide_DUSP9', 'guide_EGR1', 'guide_ELMSAN1', 'guide_ETS2', 'guide_FEV', 'guide_FOSB', 'guide_FOXA1', 'guide_FOXA3', 'guide_FOXF1', 'guide_FOXL2', 'guide_FOXO4', 'guide_GLB1L2', 'guide_HES7', 'guide_HK2', 'guide_HNF4A', 'guide_HOXA13', 'guide_HOXB9', 'guide_HOXC13', 'guide_IER5L', 'guide_IGDCC3', 'guide_IKZF3', 'guide_IRF1', 'guide_ISL2', 'guide_JUN', 'guide_KIAA1804', 'guide_KIF18B', 'guide_KIF2C', 'guide_KLF1', 'guide_KMT2A', 'guide_LHX1', 'guide_LYL1', 'guide_MAML2', 'guide_MAP2K3', 'guide_MAP2K6', 'guide_MAP4K3', 'guide_MAP4K5', 'guide_MAP7D1', 'guide_MAPK1', 'guide_MEIS1', 'guide_MIDN', 'guide_NCL', 'guide_NIT1', 'guide_OSR2', 'guide_PLK4', 'guide_POU3F2', 'guide_PRDM1', 'guide_PRTG', 'guide_PTPN1', 'guide_PTPN12', 'guide_PTPN13', 'guide_PTPN9', 'guide_RHOXF2', 'guide_RREB1', 'guide_RUNX1T1', 'guide_S1PR2', 'guide_SAMD1', 'guide_SET', 'guide_SGK1', 'guide_SLC38A2', 'guide_SLC4A1', 'guide_SLC6A9', 'guide_SNAI1', 'guide_SPI1', 'guide_STIL', 'guide_TBX2', 'guide_TBX3', 'guide_TGFBR2', 'guide_TMSB4X', 'guide_TP73', 'guide_TSC22D1', 'guide_UBASH3A', 'guide_UBASH3B', 'guide_ZBTB1', 'guide_ZBTB10', 'guide_ZBTB25', 'guide_ZC3HAV1', 'guide_ZNF318', 'guide_ids', 'n_genes', 'n_genes_by_counts', 'total_counts', 'total_counts_mt', 'pct_counts_mt', 'leiden', 'perturbation_name', 'perturbation_type', 'perturbation_value', 'perturbation_unit'
    var: 'index', 'n_cells', 'mt', 'n_cells_by_counts', 'mean_counts', 'pct_dropout_by_counts', 'total_counts', 'highly_variable', 'means', 'dispersions', 'dispersions_norm', 'ensembl_id', 'ensembl_id_collapsed'
    uns: 'doi', 'hvg', 'leiden', 'neighbors', 'pca', 'preprocessing_nb_link', 'umap', 'log1p'
    obsm: 'X_pca', 'X_umap'
    varm: 'PCs'
    layers: 'counts'
    obsp: 'connectivities', 'distances' has no column attribute 'filter_pass'; tokenizing all cells.
[2025-12-17 21:08:10,136][helical.models.geneformer.geneformer_tokenizer][INFO] - Creating dataset.
[2025-12-17 21:08:10,154][helical.models.geneformer.model][INFO] - Successfully processed the data for Geneformer.
[2025-12-17 21:08:10,154][__main__][INFO] - Extracting embeddings...
[2025-12-17 21:08:10,154][helical.models.geneformer.model][INFO] - Started getting embeddings:
[2025-12-17 21:08:10,154][helical.models.geneformer.geneformer_utils][WARNING] - CLS token present in token dictionary, excluding from average.
[2025-12-17 21:08:10,154][helical.models.geneformer.geneformer_utils][WARNING] - EOS token present in token dictionary, excluding from average.
[2025-12-17 21:08:10,724][helical.models.geneformer.model][INFO] - Finished getting embeddings.
[2025-12-17 21:08:10,724][__main__][INFO] - Extracted embeddings shape: (1000, 512)
[2025-12-17 21:08:10,724][__main__][INFO] - Perturbing gene: RER1 (type: knockout)
[2025-12-17 21:08:10,724][__main__][WARNING] - Using manual perturbation for RER1
[2025-12-17 21:08:10,726][py.warnings][WARNING] - /opt/conda/lib/python3.10/site-packages/scipy/sparse/_index.py:151: SparseEfficiencyWarning: Changing the sparsity structure of a csr_matrix is expensive. lil_matrix is more efficient.
  self._set_arrayXarray(i, j, x)

[2025-12-17 21:08:10,729][helical.models.geneformer.model][INFO] - Processing data for Geneformer.
[2025-12-17 21:08:11,081][helical.utils.mapping][INFO] - Mapped 68 / 100 genes to Ensembl IDs.
[2025-12-17 21:08:11,098][helical.models.geneformer.geneformer_tokenizer][INFO] - AnnData object with n_obs × n_vars = 1000 × 100
    obs: 'guide_identity', 'read_count', 'UMI_count', 'coverage', 'gemgroup', 'good_coverage', 'number_of_cells', 'guide_AHR', 'guide_ARID1A', 'guide_ARRDC3', 'guide_ATL1', 'guide_BAK1', 'guide_BCL2L11', 'guide_BCORL1', 'guide_BPGM', 'guide_C19orf26', 'guide_C3orf72', 'guide_CBFA2T3', 'guide_CBL', 'guide_CDKN1A', 'guide_CDKN1B', 'guide_CDKN1C', 'guide_CEBPA', 'guide_CEBPB', 'guide_CEBPE', 'guide_CELF2', 'guide_CITED1', 'guide_CKS1B', 'guide_CLDN6', 'guide_CNN1', 'guide_CNNM4', 'guide_COL1A1', 'guide_COL2A1', 'guide_CSRNP1', 'guide_DLX2', 'guide_DUSP9', 'guide_EGR1', 'guide_ELMSAN1', 'guide_ETS2', 'guide_FEV', 'guide_FOSB', 'guide_FOXA1', 'guide_FOXA3', 'guide_FOXF1', 'guide_FOXL2', 'guide_FOXO4', 'guide_GLB1L2', 'guide_HES7', 'guide_HK2', 'guide_HNF4A', 'guide_HOXA13', 'guide_HOXB9', 'guide_HOXC13', 'guide_IER5L', 'guide_IGDCC3', 'guide_IKZF3', 'guide_IRF1', 'guide_ISL2', 'guide_JUN', 'guide_KIAA1804', 'guide_KIF18B', 'guide_KIF2C', 'guide_KLF1', 'guide_KMT2A', 'guide_LHX1', 'guide_LYL1', 'guide_MAML2', 'guide_MAP2K3', 'guide_MAP2K6', 'guide_MAP4K3', 'guide_MAP4K5', 'guide_MAP7D1', 'guide_MAPK1', 'guide_MEIS1', 'guide_MIDN', 'guide_NCL', 'guide_NIT1', 'guide_OSR2', 'guide_PLK4', 'guide_POU3F2', 'guide_PRDM1', 'guide_PRTG', 'guide_PTPN1', 'guide_PTPN12', 'guide_PTPN13', 'guide_PTPN9', 'guide_RHOXF2', 'guide_RREB1', 'guide_RUNX1T1', 'guide_S1PR2', 'guide_SAMD1', 'guide_SET', 'guide_SGK1', 'guide_SLC38A2', 'guide_SLC4A1', 'guide_SLC6A9', 'guide_SNAI1', 'guide_SPI1', 'guide_STIL', 'guide_TBX2', 'guide_TBX3', 'guide_TGFBR2', 'guide_TMSB4X', 'guide_TP73', 'guide_TSC22D1', 'guide_UBASH3A', 'guide_UBASH3B', 'guide_ZBTB1', 'guide_ZBTB10', 'guide_ZBTB25', 'guide_ZC3HAV1', 'guide_ZNF318', 'guide_ids', 'n_genes', 'n_genes_by_counts', 'total_counts', 'total_counts_mt', 'pct_counts_mt', 'leiden', 'perturbation_name', 'perturbation_type', 'perturbation_value', 'perturbation_unit'
    var: 'index', 'n_cells', 'mt', 'n_cells_by_counts', 'mean_counts', 'pct_dropout_by_counts', 'total_counts', 'highly_variable', 'means', 'dispersions', 'dispersions_norm', 'ensembl_id', 'ensembl_id_collapsed'
    uns: 'doi', 'hvg', 'leiden', 'neighbors', 'pca', 'preprocessing_nb_link', 'umap', 'log1p'
    obsm: 'X_pca', 'X_umap'
    varm: 'PCs'
    layers: 'counts'
    obsp: 'connectivities', 'distances' has no column attribute 'filter_pass'; tokenizing all cells.
[2025-12-17 21:08:11,222][helical.models.geneformer.geneformer_tokenizer][INFO] - Creating dataset.
[2025-12-17 21:08:11,240][helical.models.geneformer.model][INFO] - Successfully processed the data for Geneformer.
[2025-12-17 21:08:11,240][__main__][INFO] - Extracting embeddings...
[2025-12-17 21:08:11,240][helical.models.geneformer.model][INFO] - Started getting embeddings:
[2025-12-17 21:08:11,240][helical.models.geneformer.geneformer_utils][WARNING] - CLS token present in token dictionary, excluding from average.
[2025-12-17 21:08:11,240][helical.models.geneformer.geneformer_utils][WARNING] - EOS token present in token dictionary, excluding from average.
[2025-12-17 21:08:11,798][helical.models.geneformer.model][INFO] - Finished getting embeddings.
[2025-12-17 21:08:11,798][__main__][INFO] - Extracted embeddings shape: (1000, 512)
[2025-12-17 21:08:11,798][__main__][INFO] - Perturbing gene: NOC2L (type: knockout)
[2025-12-17 21:08:11,798][__main__][WARNING] - Using manual perturbation for NOC2L
[2025-12-17 21:08:11,800][py.warnings][WARNING] - /opt/conda/lib/python3.10/site-packages/scipy/sparse/_index.py:151: SparseEfficiencyWarning: Changing the sparsity structure of a csr_matrix is expensive. lil_matrix is more efficient.
  self._set_arrayXarray(i, j, x)

[2025-12-17 21:08:11,803][helical.models.geneformer.model][INFO] - Processing data for Geneformer.
[2025-12-17 21:08:12,157][helical.utils.mapping][INFO] - Mapped 68 / 100 genes to Ensembl IDs.
[2025-12-17 21:08:12,176][helical.models.geneformer.geneformer_tokenizer][INFO] - AnnData object with n_obs × n_vars = 1000 × 100
    obs: 'guide_identity', 'read_count', 'UMI_count', 'coverage', 'gemgroup', 'good_coverage', 'number_of_cells', 'guide_AHR', 'guide_ARID1A', 'guide_ARRDC3', 'guide_ATL1', 'guide_BAK1', 'guide_BCL2L11', 'guide_BCORL1', 'guide_BPGM', 'guide_C19orf26', 'guide_C3orf72', 'guide_CBFA2T3', 'guide_CBL', 'guide_CDKN1A', 'guide_CDKN1B', 'guide_CDKN1C', 'guide_CEBPA', 'guide_CEBPB', 'guide_CEBPE', 'guide_CELF2', 'guide_CITED1', 'guide_CKS1B', 'guide_CLDN6', 'guide_CNN1', 'guide_CNNM4', 'guide_COL1A1', 'guide_COL2A1', 'guide_CSRNP1', 'guide_DLX2', 'guide_DUSP9', 'guide_EGR1', 'guide_ELMSAN1', 'guide_ETS2', 'guide_FEV', 'guide_FOSB', 'guide_FOXA1', 'guide_FOXA3', 'guide_FOXF1', 'guide_FOXL2', 'guide_FOXO4', 'guide_GLB1L2', 'guide_HES7', 'guide_HK2', 'guide_HNF4A', 'guide_HOXA13', 'guide_HOXB9', 'guide_HOXC13', 'guide_IER5L', 'guide_IGDCC3', 'guide_IKZF3', 'guide_IRF1', 'guide_ISL2', 'guide_JUN', 'guide_KIAA1804', 'guide_KIF18B', 'guide_KIF2C', 'guide_KLF1', 'guide_KMT2A', 'guide_LHX1', 'guide_LYL1', 'guide_MAML2', 'guide_MAP2K3', 'guide_MAP2K6', 'guide_MAP4K3', 'guide_MAP4K5', 'guide_MAP7D1', 'guide_MAPK1', 'guide_MEIS1', 'guide_MIDN', 'guide_NCL', 'guide_NIT1', 'guide_OSR2', 'guide_PLK4', 'guide_POU3F2', 'guide_PRDM1', 'guide_PRTG', 'guide_PTPN1', 'guide_PTPN12', 'guide_PTPN13', 'guide_PTPN9', 'guide_RHOXF2', 'guide_RREB1', 'guide_RUNX1T1', 'guide_S1PR2', 'guide_SAMD1', 'guide_SET', 'guide_SGK1', 'guide_SLC38A2', 'guide_SLC4A1', 'guide_SLC6A9', 'guide_SNAI1', 'guide_SPI1', 'guide_STIL', 'guide_TBX2', 'guide_TBX3', 'guide_TGFBR2', 'guide_TMSB4X', 'guide_TP73', 'guide_TSC22D1', 'guide_UBASH3A', 'guide_UBASH3B', 'guide_ZBTB1', 'guide_ZBTB10', 'guide_ZBTB25', 'guide_ZC3HAV1', 'guide_ZNF318', 'guide_ids', 'n_genes', 'n_genes_by_counts', 'total_counts', 'total_counts_mt', 'pct_counts_mt', 'leiden', 'perturbation_name', 'perturbation_type', 'perturbation_value', 'perturbation_unit'
    var: 'index', 'n_cells', 'mt', 'n_cells_by_counts', 'mean_counts', 'pct_dropout_by_counts', 'total_counts', 'highly_variable', 'means', 'dispersions', 'dispersions_norm', 'ensembl_id', 'ensembl_id_collapsed'
    uns: 'doi', 'hvg', 'leiden', 'neighbors', 'pca', 'preprocessing_nb_link', 'umap', 'log1p'
    obsm: 'X_pca', 'X_umap'
    varm: 'PCs'
    layers: 'counts'
    obsp: 'connectivities', 'distances' has no column attribute 'filter_pass'; tokenizing all cells.
[2025-12-17 21:08:12,303][helical.models.geneformer.geneformer_tokenizer][INFO] - Creating dataset.
[2025-12-17 21:08:12,320][helical.models.geneformer.model][INFO] - Successfully processed the data for Geneformer.
[2025-12-17 21:08:12,321][__main__][INFO] - Extracting embeddings...
[2025-12-17 21:08:12,321][helical.models.geneformer.model][INFO] - Started getting embeddings:
[2025-12-17 21:08:12,321][helical.models.geneformer.geneformer_utils][WARNING] - CLS token present in token dictionary, excluding from average.
[2025-12-17 21:08:12,321][helical.models.geneformer.geneformer_utils][WARNING] - EOS token present in token dictionary, excluding from average.
[2025-12-17 21:08:12,885][helical.models.geneformer.model][INFO] - Finished getting embeddings.
[2025-12-17 21:08:12,885][__main__][INFO] - Extracted embeddings shape: (1000, 512)
[2025-12-17 21:08:12,886][__main__][INFO] - Perturbing gene: GNB1 (type: knockout)
[2025-12-17 21:08:12,886][__main__][WARNING] - Using manual perturbation for GNB1
[2025-12-17 21:08:12,888][py.warnings][WARNING] - /opt/conda/lib/python3.10/site-packages/scipy/sparse/_index.py:151: SparseEfficiencyWarning: Changing the sparsity structure of a csr_matrix is expensive. lil_matrix is more efficient.
  self._set_arrayXarray(i, j, x)

[2025-12-17 21:08:12,890][helical.models.geneformer.model][INFO] - Processing data for Geneformer.
[2025-12-17 21:08:13,237][helical.utils.mapping][INFO] - Mapped 68 / 100 genes to Ensembl IDs.
[2025-12-17 21:08:13,256][helical.models.geneformer.geneformer_tokenizer][INFO] - AnnData object with n_obs × n_vars = 1000 × 100
    obs: 'guide_identity', 'read_count', 'UMI_count', 'coverage', 'gemgroup', 'good_coverage', 'number_of_cells', 'guide_AHR', 'guide_ARID1A', 'guide_ARRDC3', 'guide_ATL1', 'guide_BAK1', 'guide_BCL2L11', 'guide_BCORL1', 'guide_BPGM', 'guide_C19orf26', 'guide_C3orf72', 'guide_CBFA2T3', 'guide_CBL', 'guide_CDKN1A', 'guide_CDKN1B', 'guide_CDKN1C', 'guide_CEBPA', 'guide_CEBPB', 'guide_CEBPE', 'guide_CELF2', 'guide_CITED1', 'guide_CKS1B', 'guide_CLDN6', 'guide_CNN1', 'guide_CNNM4', 'guide_COL1A1', 'guide_COL2A1', 'guide_CSRNP1', 'guide_DLX2', 'guide_DUSP9', 'guide_EGR1', 'guide_ELMSAN1', 'guide_ETS2', 'guide_FEV', 'guide_FOSB', 'guide_FOXA1', 'guide_FOXA3', 'guide_FOXF1', 'guide_FOXL2', 'guide_FOXO4', 'guide_GLB1L2', 'guide_HES7', 'guide_HK2', 'guide_HNF4A', 'guide_HOXA13', 'guide_HOXB9', 'guide_HOXC13', 'guide_IER5L', 'guide_IGDCC3', 'guide_IKZF3', 'guide_IRF1', 'guide_ISL2', 'guide_JUN', 'guide_KIAA1804', 'guide_KIF18B', 'guide_KIF2C', 'guide_KLF1', 'guide_KMT2A', 'guide_LHX1', 'guide_LYL1', 'guide_MAML2', 'guide_MAP2K3', 'guide_MAP2K6', 'guide_MAP4K3', 'guide_MAP4K5', 'guide_MAP7D1', 'guide_MAPK1', 'guide_MEIS1', 'guide_MIDN', 'guide_NCL', 'guide_NIT1', 'guide_OSR2', 'guide_PLK4', 'guide_POU3F2', 'guide_PRDM1', 'guide_PRTG', 'guide_PTPN1', 'guide_PTPN12', 'guide_PTPN13', 'guide_PTPN9', 'guide_RHOXF2', 'guide_RREB1', 'guide_RUNX1T1', 'guide_S1PR2', 'guide_SAMD1', 'guide_SET', 'guide_SGK1', 'guide_SLC38A2', 'guide_SLC4A1', 'guide_SLC6A9', 'guide_SNAI1', 'guide_SPI1', 'guide_STIL', 'guide_TBX2', 'guide_TBX3', 'guide_TGFBR2', 'guide_TMSB4X', 'guide_TP73', 'guide_TSC22D1', 'guide_UBASH3A', 'guide_UBASH3B', 'guide_ZBTB1', 'guide_ZBTB10', 'guide_ZBTB25', 'guide_ZC3HAV1', 'guide_ZNF318', 'guide_ids', 'n_genes', 'n_genes_by_counts', 'total_counts', 'total_counts_mt', 'pct_counts_mt', 'leiden', 'perturbation_name', 'perturbation_type', 'perturbation_value', 'perturbation_unit'
    var: 'index', 'n_cells', 'mt', 'n_cells_by_counts', 'mean_counts', 'pct_dropout_by_counts', 'total_counts', 'highly_variable', 'means', 'dispersions', 'dispersions_norm', 'ensembl_id', 'ensembl_id_collapsed'
    uns: 'doi', 'hvg', 'leiden', 'neighbors', 'pca', 'preprocessing_nb_link', 'umap', 'log1p'
    obsm: 'X_pca', 'X_umap'
    varm: 'PCs'
    layers: 'counts'
    obsp: 'connectivities', 'distances' has no column attribute 'filter_pass'; tokenizing all cells.
[2025-12-17 21:08:13,380][helical.models.geneformer.geneformer_tokenizer][INFO] - Creating dataset.
[2025-12-17 21:08:13,397][helical.models.geneformer.model][INFO] - Successfully processed the data for Geneformer.
[2025-12-17 21:08:13,398][__main__][INFO] - Extracting embeddings...
[2025-12-17 21:08:13,398][helical.models.geneformer.model][INFO] - Started getting embeddings:
[2025-12-17 21:08:13,398][helical.models.geneformer.geneformer_utils][WARNING] - CLS token present in token dictionary, excluding from average.
[2025-12-17 21:08:13,398][helical.models.geneformer.geneformer_utils][WARNING] - EOS token present in token dictionary, excluding from average.
[2025-12-17 21:08:13,960][helical.models.geneformer.model][INFO] - Finished getting embeddings.
[2025-12-17 21:08:13,960][__main__][INFO] - Extracted embeddings shape: (1000, 512)
[2025-12-17 21:08:13,961][__main__][INFO] - Perturbing gene: FAAP20 (type: knockout)
[2025-12-17 21:08:13,961][__main__][WARNING] - Using manual perturbation for FAAP20
[2025-12-17 21:08:13,963][py.warnings][WARNING] - /opt/conda/lib/python3.10/site-packages/scipy/sparse/_index.py:151: SparseEfficiencyWarning: Changing the sparsity structure of a csr_matrix is expensive. lil_matrix is more efficient.
  self._set_arrayXarray(i, j, x)

[2025-12-17 21:08:13,965][helical.models.geneformer.model][INFO] - Processing data for Geneformer.
[2025-12-17 21:08:14,311][helical.utils.mapping][INFO] - Mapped 68 / 100 genes to Ensembl IDs.
[2025-12-17 21:08:14,328][helical.models.geneformer.geneformer_tokenizer][INFO] - AnnData object with n_obs × n_vars = 1000 × 100
    obs: 'guide_identity', 'read_count', 'UMI_count', 'coverage', 'gemgroup', 'good_coverage', 'number_of_cells', 'guide_AHR', 'guide_ARID1A', 'guide_ARRDC3', 'guide_ATL1', 'guide_BAK1', 'guide_BCL2L11', 'guide_BCORL1', 'guide_BPGM', 'guide_C19orf26', 'guide_C3orf72', 'guide_CBFA2T3', 'guide_CBL', 'guide_CDKN1A', 'guide_CDKN1B', 'guide_CDKN1C', 'guide_CEBPA', 'guide_CEBPB', 'guide_CEBPE', 'guide_CELF2', 'guide_CITED1', 'guide_CKS1B', 'guide_CLDN6', 'guide_CNN1', 'guide_CNNM4', 'guide_COL1A1', 'guide_COL2A1', 'guide_CSRNP1', 'guide_DLX2', 'guide_DUSP9', 'guide_EGR1', 'guide_ELMSAN1', 'guide_ETS2', 'guide_FEV', 'guide_FOSB', 'guide_FOXA1', 'guide_FOXA3', 'guide_FOXF1', 'guide_FOXL2', 'guide_FOXO4', 'guide_GLB1L2', 'guide_HES7', 'guide_HK2', 'guide_HNF4A', 'guide_HOXA13', 'guide_HOXB9', 'guide_HOXC13', 'guide_IER5L', 'guide_IGDCC3', 'guide_IKZF3', 'guide_IRF1', 'guide_ISL2', 'guide_JUN', 'guide_KIAA1804', 'guide_KIF18B', 'guide_KIF2C', 'guide_KLF1', 'guide_KMT2A', 'guide_LHX1', 'guide_LYL1', 'guide_MAML2', 'guide_MAP2K3', 'guide_MAP2K6', 'guide_MAP4K3', 'guide_MAP4K5', 'guide_MAP7D1', 'guide_MAPK1', 'guide_MEIS1', 'guide_MIDN', 'guide_NCL', 'guide_NIT1', 'guide_OSR2', 'guide_PLK4', 'guide_POU3F2', 'guide_PRDM1', 'guide_PRTG', 'guide_PTPN1', 'guide_PTPN12', 'guide_PTPN13', 'guide_PTPN9', 'guide_RHOXF2', 'guide_RREB1', 'guide_RUNX1T1', 'guide_S1PR2', 'guide_SAMD1', 'guide_SET', 'guide_SGK1', 'guide_SLC38A2', 'guide_SLC4A1', 'guide_SLC6A9', 'guide_SNAI1', 'guide_SPI1', 'guide_STIL', 'guide_TBX2', 'guide_TBX3', 'guide_TGFBR2', 'guide_TMSB4X', 'guide_TP73', 'guide_TSC22D1', 'guide_UBASH3A', 'guide_UBASH3B', 'guide_ZBTB1', 'guide_ZBTB10', 'guide_ZBTB25', 'guide_ZC3HAV1', 'guide_ZNF318', 'guide_ids', 'n_genes', 'n_genes_by_counts', 'total_counts', 'total_counts_mt', 'pct_counts_mt', 'leiden', 'perturbation_name', 'perturbation_type', 'perturbation_value', 'perturbation_unit'
    var: 'index', 'n_cells', 'mt', 'n_cells_by_counts', 'mean_counts', 'pct_dropout_by_counts', 'total_counts', 'highly_variable', 'means', 'dispersions', 'dispersions_norm', 'ensembl_id', 'ensembl_id_collapsed'
    uns: 'doi', 'hvg', 'leiden', 'neighbors', 'pca', 'preprocessing_nb_link', 'umap', 'log1p'
    obsm: 'X_pca', 'X_umap'
    varm: 'PCs'
    layers: 'counts'
    obsp: 'connectivities', 'distances' has no column attribute 'filter_pass'; tokenizing all cells.
[2025-12-17 21:08:14,457][helical.models.geneformer.geneformer_tokenizer][INFO] - Creating dataset.
[2025-12-17 21:08:14,475][helical.models.geneformer.model][INFO] - Successfully processed the data for Geneformer.
[2025-12-17 21:08:14,476][__main__][INFO] - Extracting embeddings...
[2025-12-17 21:08:14,476][helical.models.geneformer.model][INFO] - Started getting embeddings:
[2025-12-17 21:08:14,476][helical.models.geneformer.geneformer_utils][WARNING] - CLS token present in token dictionary, excluding from average.
[2025-12-17 21:08:14,476][helical.models.geneformer.geneformer_utils][WARNING] - EOS token present in token dictionary, excluding from average.
[2025-12-17 21:08:15,037][helical.models.geneformer.model][INFO] - Finished getting embeddings.
[2025-12-17 21:08:15,037][__main__][INFO] - Extracted embeddings shape: (1000, 512)
[2025-12-17 21:08:15,037][__main__][INFO] - Perturbing gene: SSU72 (type: knockout)
[2025-12-17 21:08:15,037][__main__][WARNING] - Using manual perturbation for SSU72
[2025-12-17 21:08:15,039][py.warnings][WARNING] - /opt/conda/lib/python3.10/site-packages/scipy/sparse/_index.py:151: SparseEfficiencyWarning: Changing the sparsity structure of a csr_matrix is expensive. lil_matrix is more efficient.
  self._set_arrayXarray(i, j, x)

[2025-12-17 21:08:15,040][helical.models.geneformer.model][INFO] - Processing data for Geneformer.
[2025-12-17 21:08:15,388][helical.utils.mapping][INFO] - Mapped 68 / 100 genes to Ensembl IDs.
[2025-12-17 21:08:15,405][helical.models.geneformer.geneformer_tokenizer][INFO] - AnnData object with n_obs × n_vars = 1000 × 100
    obs: 'guide_identity', 'read_count', 'UMI_count', 'coverage', 'gemgroup', 'good_coverage', 'number_of_cells', 'guide_AHR', 'guide_ARID1A', 'guide_ARRDC3', 'guide_ATL1', 'guide_BAK1', 'guide_BCL2L11', 'guide_BCORL1', 'guide_BPGM', 'guide_C19orf26', 'guide_C3orf72', 'guide_CBFA2T3', 'guide_CBL', 'guide_CDKN1A', 'guide_CDKN1B', 'guide_CDKN1C', 'guide_CEBPA', 'guide_CEBPB', 'guide_CEBPE', 'guide_CELF2', 'guide_CITED1', 'guide_CKS1B', 'guide_CLDN6', 'guide_CNN1', 'guide_CNNM4', 'guide_COL1A1', 'guide_COL2A1', 'guide_CSRNP1', 'guide_DLX2', 'guide_DUSP9', 'guide_EGR1', 'guide_ELMSAN1', 'guide_ETS2', 'guide_FEV', 'guide_FOSB', 'guide_FOXA1', 'guide_FOXA3', 'guide_FOXF1', 'guide_FOXL2', 'guide_FOXO4', 'guide_GLB1L2', 'guide_HES7', 'guide_HK2', 'guide_HNF4A', 'guide_HOXA13', 'guide_HOXB9', 'guide_HOXC13', 'guide_IER5L', 'guide_IGDCC3', 'guide_IKZF3', 'guide_IRF1', 'guide_ISL2', 'guide_JUN', 'guide_KIAA1804', 'guide_KIF18B', 'guide_KIF2C', 'guide_KLF1', 'guide_KMT2A', 'guide_LHX1', 'guide_LYL1', 'guide_MAML2', 'guide_MAP2K3', 'guide_MAP2K6', 'guide_MAP4K3', 'guide_MAP4K5', 'guide_MAP7D1', 'guide_MAPK1', 'guide_MEIS1', 'guide_MIDN', 'guide_NCL', 'guide_NIT1', 'guide_OSR2', 'guide_PLK4', 'guide_POU3F2', 'guide_PRDM1', 'guide_PRTG', 'guide_PTPN1', 'guide_PTPN12', 'guide_PTPN13', 'guide_PTPN9', 'guide_RHOXF2', 'guide_RREB1', 'guide_RUNX1T1', 'guide_S1PR2', 'guide_SAMD1', 'guide_SET', 'guide_SGK1', 'guide_SLC38A2', 'guide_SLC4A1', 'guide_SLC6A9', 'guide_SNAI1', 'guide_SPI1', 'guide_STIL', 'guide_TBX2', 'guide_TBX3', 'guide_TGFBR2', 'guide_TMSB4X', 'guide_TP73', 'guide_TSC22D1', 'guide_UBASH3A', 'guide_UBASH3B', 'guide_ZBTB1', 'guide_ZBTB10', 'guide_ZBTB25', 'guide_ZC3HAV1', 'guide_ZNF318', 'guide_ids', 'n_genes', 'n_genes_by_counts', 'total_counts', 'total_counts_mt', 'pct_counts_mt', 'leiden', 'perturbation_name', 'perturbation_type', 'perturbation_value', 'perturbation_unit'
    var: 'index', 'n_cells', 'mt', 'n_cells_by_counts', 'mean_counts', 'pct_dropout_by_counts', 'total_counts', 'highly_variable', 'means', 'dispersions', 'dispersions_norm', 'ensembl_id', 'ensembl_id_collapsed'
    uns: 'doi', 'hvg', 'leiden', 'neighbors', 'pca', 'preprocessing_nb_link', 'umap', 'log1p'
    obsm: 'X_pca', 'X_umap'
    varm: 'PCs'
    layers: 'counts'
    obsp: 'connectivities', 'distances' has no column attribute 'filter_pass'; tokenizing all cells.
[2025-12-17 21:08:15,534][helical.models.geneformer.geneformer_tokenizer][INFO] - Creating dataset.
[2025-12-17 21:08:15,552][helical.models.geneformer.model][INFO] - Successfully processed the data for Geneformer.
[2025-12-17 21:08:15,552][__main__][INFO] - Extracting embeddings...
[2025-12-17 21:08:15,552][helical.models.geneformer.model][INFO] - Started getting embeddings:
[2025-12-17 21:08:15,552][helical.models.geneformer.geneformer_utils][WARNING] - CLS token present in token dictionary, excluding from average.
[2025-12-17 21:08:15,552][helical.models.geneformer.geneformer_utils][WARNING] - EOS token present in token dictionary, excluding from average.
[2025-12-17 21:08:16,112][helical.models.geneformer.model][INFO] - Finished getting embeddings.
[2025-12-17 21:08:16,112][__main__][INFO] - Extracted embeddings shape: (1000, 512)
[2025-12-17 21:08:16,112][__main__][INFO] - Perturbing gene: MRPL20 (type: knockout)
[2025-12-17 21:08:16,112][__main__][WARNING] - Using manual perturbation for MRPL20
[2025-12-17 21:08:16,114][py.warnings][WARNING] - /opt/conda/lib/python3.10/site-packages/scipy/sparse/_index.py:151: SparseEfficiencyWarning: Changing the sparsity structure of a csr_matrix is expensive. lil_matrix is more efficient.
  self._set_arrayXarray(i, j, x)

[2025-12-17 21:08:16,115][helical.models.geneformer.model][INFO] - Processing data for Geneformer.
[2025-12-17 21:08:16,459][helical.utils.mapping][INFO] - Mapped 68 / 100 genes to Ensembl IDs.
[2025-12-17 21:08:16,477][helical.models.geneformer.geneformer_tokenizer][INFO] - AnnData object with n_obs × n_vars = 1000 × 100
    obs: 'guide_identity', 'read_count', 'UMI_count', 'coverage', 'gemgroup', 'good_coverage', 'number_of_cells', 'guide_AHR', 'guide_ARID1A', 'guide_ARRDC3', 'guide_ATL1', 'guide_BAK1', 'guide_BCL2L11', 'guide_BCORL1', 'guide_BPGM', 'guide_C19orf26', 'guide_C3orf72', 'guide_CBFA2T3', 'guide_CBL', 'guide_CDKN1A', 'guide_CDKN1B', 'guide_CDKN1C', 'guide_CEBPA', 'guide_CEBPB', 'guide_CEBPE', 'guide_CELF2', 'guide_CITED1', 'guide_CKS1B', 'guide_CLDN6', 'guide_CNN1', 'guide_CNNM4', 'guide_COL1A1', 'guide_COL2A1', 'guide_CSRNP1', 'guide_DLX2', 'guide_DUSP9', 'guide_EGR1', 'guide_ELMSAN1', 'guide_ETS2', 'guide_FEV', 'guide_FOSB', 'guide_FOXA1', 'guide_FOXA3', 'guide_FOXF1', 'guide_FOXL2', 'guide_FOXO4', 'guide_GLB1L2', 'guide_HES7', 'guide_HK2', 'guide_HNF4A', 'guide_HOXA13', 'guide_HOXB9', 'guide_HOXC13', 'guide_IER5L', 'guide_IGDCC3', 'guide_IKZF3', 'guide_IRF1', 'guide_ISL2', 'guide_JUN', 'guide_KIAA1804', 'guide_KIF18B', 'guide_KIF2C', 'guide_KLF1', 'guide_KMT2A', 'guide_LHX1', 'guide_LYL1', 'guide_MAML2', 'guide_MAP2K3', 'guide_MAP2K6', 'guide_MAP4K3', 'guide_MAP4K5', 'guide_MAP7D1', 'guide_MAPK1', 'guide_MEIS1', 'guide_MIDN', 'guide_NCL', 'guide_NIT1', 'guide_OSR2', 'guide_PLK4', 'guide_POU3F2', 'guide_PRDM1', 'guide_PRTG', 'guide_PTPN1', 'guide_PTPN12', 'guide_PTPN13', 'guide_PTPN9', 'guide_RHOXF2', 'guide_RREB1', 'guide_RUNX1T1', 'guide_S1PR2', 'guide_SAMD1', 'guide_SET', 'guide_SGK1', 'guide_SLC38A2', 'guide_SLC4A1', 'guide_SLC6A9', 'guide_SNAI1', 'guide_SPI1', 'guide_STIL', 'guide_TBX2', 'guide_TBX3', 'guide_TGFBR2', 'guide_TMSB4X', 'guide_TP73', 'guide_TSC22D1', 'guide_UBASH3A', 'guide_UBASH3B', 'guide_ZBTB1', 'guide_ZBTB10', 'guide_ZBTB25', 'guide_ZC3HAV1', 'guide_ZNF318', 'guide_ids', 'n_genes', 'n_genes_by_counts', 'total_counts', 'total_counts_mt', 'pct_counts_mt', 'leiden', 'perturbation_name', 'perturbation_type', 'perturbation_value', 'perturbation_unit'
    var: 'index', 'n_cells', 'mt', 'n_cells_by_counts', 'mean_counts', 'pct_dropout_by_counts', 'total_counts', 'highly_variable', 'means', 'dispersions', 'dispersions_norm', 'ensembl_id', 'ensembl_id_collapsed'
    uns: 'doi', 'hvg', 'leiden', 'neighbors', 'pca', 'preprocessing_nb_link', 'umap', 'log1p'
    obsm: 'X_pca', 'X_umap'
    varm: 'PCs'
    layers: 'counts'
    obsp: 'connectivities', 'distances' has no column attribute 'filter_pass'; tokenizing all cells.
[2025-12-17 21:08:16,605][helical.models.geneformer.geneformer_tokenizer][INFO] - Creating dataset.
[2025-12-17 21:08:16,623][helical.models.geneformer.model][INFO] - Successfully processed the data for Geneformer.
[2025-12-17 21:08:16,623][__main__][INFO] - Extracting embeddings...
[2025-12-17 21:08:16,624][helical.models.geneformer.model][INFO] - Started getting embeddings:
[2025-12-17 21:08:16,624][helical.models.geneformer.geneformer_utils][WARNING] - CLS token present in token dictionary, excluding from average.
[2025-12-17 21:08:16,624][helical.models.geneformer.geneformer_utils][WARNING] - EOS token present in token dictionary, excluding from average.
[2025-12-17 21:08:17,187][helical.models.geneformer.model][INFO] - Finished getting embeddings.
[2025-12-17 21:08:17,187][__main__][INFO] - Extracted embeddings shape: (1000, 512)
[2025-12-17 21:08:17,187][__main__][INFO] - Perturbing gene: AURKAIP1 (type: knockout)
[2025-12-17 21:08:17,187][__main__][WARNING] - Using manual perturbation for AURKAIP1
[2025-12-17 21:08:17,189][py.warnings][WARNING] - /opt/conda/lib/python3.10/site-packages/scipy/sparse/_index.py:151: SparseEfficiencyWarning: Changing the sparsity structure of a csr_matrix is expensive. lil_matrix is more efficient.
  self._set_arrayXarray(i, j, x)

[2025-12-17 21:08:17,190][helical.models.geneformer.model][INFO] - Processing data for Geneformer.
[2025-12-17 21:08:17,556][helical.utils.mapping][INFO] - Mapped 68 / 100 genes to Ensembl IDs.
[2025-12-17 21:08:17,574][helical.models.geneformer.geneformer_tokenizer][INFO] - AnnData object with n_obs × n_vars = 1000 × 100
    obs: 'guide_identity', 'read_count', 'UMI_count', 'coverage', 'gemgroup', 'good_coverage', 'number_of_cells', 'guide_AHR', 'guide_ARID1A', 'guide_ARRDC3', 'guide_ATL1', 'guide_BAK1', 'guide_BCL2L11', 'guide_BCORL1', 'guide_BPGM', 'guide_C19orf26', 'guide_C3orf72', 'guide_CBFA2T3', 'guide_CBL', 'guide_CDKN1A', 'guide_CDKN1B', 'guide_CDKN1C', 'guide_CEBPA', 'guide_CEBPB', 'guide_CEBPE', 'guide_CELF2', 'guide_CITED1', 'guide_CKS1B', 'guide_CLDN6', 'guide_CNN1', 'guide_CNNM4', 'guide_COL1A1', 'guide_COL2A1', 'guide_CSRNP1', 'guide_DLX2', 'guide_DUSP9', 'guide_EGR1', 'guide_ELMSAN1', 'guide_ETS2', 'guide_FEV', 'guide_FOSB', 'guide_FOXA1', 'guide_FOXA3', 'guide_FOXF1', 'guide_FOXL2', 'guide_FOXO4', 'guide_GLB1L2', 'guide_HES7', 'guide_HK2', 'guide_HNF4A', 'guide_HOXA13', 'guide_HOXB9', 'guide_HOXC13', 'guide_IER5L', 'guide_IGDCC3', 'guide_IKZF3', 'guide_IRF1', 'guide_ISL2', 'guide_JUN', 'guide_KIAA1804', 'guide_KIF18B', 'guide_KIF2C', 'guide_KLF1', 'guide_KMT2A', 'guide_LHX1', 'guide_LYL1', 'guide_MAML2', 'guide_MAP2K3', 'guide_MAP2K6', 'guide_MAP4K3', 'guide_MAP4K5', 'guide_MAP7D1', 'guide_MAPK1', 'guide_MEIS1', 'guide_MIDN', 'guide_NCL', 'guide_NIT1', 'guide_OSR2', 'guide_PLK4', 'guide_POU3F2', 'guide_PRDM1', 'guide_PRTG', 'guide_PTPN1', 'guide_PTPN12', 'guide_PTPN13', 'guide_PTPN9', 'guide_RHOXF2', 'guide_RREB1', 'guide_RUNX1T1', 'guide_S1PR2', 'guide_SAMD1', 'guide_SET', 'guide_SGK1', 'guide_SLC38A2', 'guide_SLC4A1', 'guide_SLC6A9', 'guide_SNAI1', 'guide_SPI1', 'guide_STIL', 'guide_TBX2', 'guide_TBX3', 'guide_TGFBR2', 'guide_TMSB4X', 'guide_TP73', 'guide_TSC22D1', 'guide_UBASH3A', 'guide_UBASH3B', 'guide_ZBTB1', 'guide_ZBTB10', 'guide_ZBTB25', 'guide_ZC3HAV1', 'guide_ZNF318', 'guide_ids', 'n_genes', 'n_genes_by_counts', 'total_counts', 'total_counts_mt', 'pct_counts_mt', 'leiden', 'perturbation_name', 'perturbation_type', 'perturbation_value', 'perturbation_unit'
    var: 'index', 'n_cells', 'mt', 'n_cells_by_counts', 'mean_counts', 'pct_dropout_by_counts', 'total_counts', 'highly_variable', 'means', 'dispersions', 'dispersions_norm', 'ensembl_id', 'ensembl_id_collapsed'
    uns: 'doi', 'hvg', 'leiden', 'neighbors', 'pca', 'preprocessing_nb_link', 'umap', 'log1p'
    obsm: 'X_pca', 'X_umap'
    varm: 'PCs'
    layers: 'counts'
    obsp: 'connectivities', 'distances' has no column attribute 'filter_pass'; tokenizing all cells.
[2025-12-17 21:08:17,698][helical.models.geneformer.geneformer_tokenizer][INFO] - Creating dataset.
[2025-12-17 21:08:17,716][helical.models.geneformer.model][INFO] - Successfully processed the data for Geneformer.
[2025-12-17 21:08:17,716][__main__][INFO] - Extracting embeddings...
[2025-12-17 21:08:17,716][helical.models.geneformer.model][INFO] - Started getting embeddings:
[2025-12-17 21:08:17,716][helical.models.geneformer.geneformer_utils][WARNING] - CLS token present in token dictionary, excluding from average.
[2025-12-17 21:08:17,716][helical.models.geneformer.geneformer_utils][WARNING] - EOS token present in token dictionary, excluding from average.
[2025-12-17 21:08:18,280][helical.models.geneformer.model][INFO] - Finished getting embeddings.
[2025-12-17 21:08:18,280][__main__][INFO] - Extracted embeddings shape: (1000, 512)
[2025-12-17 21:08:18,280][__main__][INFO] - Perturbing gene: RPL22 (type: knockout)
[2025-12-17 21:08:18,280][__main__][WARNING] - Using manual perturbation for RPL22
[2025-12-17 21:08:18,282][helical.models.geneformer.model][INFO] - Processing data for Geneformer.
[2025-12-17 21:08:18,613][helical.utils.mapping][INFO] - Mapped 68 / 100 genes to Ensembl IDs.
[2025-12-17 21:08:18,631][helical.models.geneformer.geneformer_tokenizer][INFO] - AnnData object with n_obs × n_vars = 1000 × 100
    obs: 'guide_identity', 'read_count', 'UMI_count', 'coverage', 'gemgroup', 'good_coverage', 'number_of_cells', 'guide_AHR', 'guide_ARID1A', 'guide_ARRDC3', 'guide_ATL1', 'guide_BAK1', 'guide_BCL2L11', 'guide_BCORL1', 'guide_BPGM', 'guide_C19orf26', 'guide_C3orf72', 'guide_CBFA2T3', 'guide_CBL', 'guide_CDKN1A', 'guide_CDKN1B', 'guide_CDKN1C', 'guide_CEBPA', 'guide_CEBPB', 'guide_CEBPE', 'guide_CELF2', 'guide_CITED1', 'guide_CKS1B', 'guide_CLDN6', 'guide_CNN1', 'guide_CNNM4', 'guide_COL1A1', 'guide_COL2A1', 'guide_CSRNP1', 'guide_DLX2', 'guide_DUSP9', 'guide_EGR1', 'guide_ELMSAN1', 'guide_ETS2', 'guide_FEV', 'guide_FOSB', 'guide_FOXA1', 'guide_FOXA3', 'guide_FOXF1', 'guide_FOXL2', 'guide_FOXO4', 'guide_GLB1L2', 'guide_HES7', 'guide_HK2', 'guide_HNF4A', 'guide_HOXA13', 'guide_HOXB9', 'guide_HOXC13', 'guide_IER5L', 'guide_IGDCC3', 'guide_IKZF3', 'guide_IRF1', 'guide_ISL2', 'guide_JUN', 'guide_KIAA1804', 'guide_KIF18B', 'guide_KIF2C', 'guide_KLF1', 'guide_KMT2A', 'guide_LHX1', 'guide_LYL1', 'guide_MAML2', 'guide_MAP2K3', 'guide_MAP2K6', 'guide_MAP4K3', 'guide_MAP4K5', 'guide_MAP7D1', 'guide_MAPK1', 'guide_MEIS1', 'guide_MIDN', 'guide_NCL', 'guide_NIT1', 'guide_OSR2', 'guide_PLK4', 'guide_POU3F2', 'guide_PRDM1', 'guide_PRTG', 'guide_PTPN1', 'guide_PTPN12', 'guide_PTPN13', 'guide_PTPN9', 'guide_RHOXF2', 'guide_RREB1', 'guide_RUNX1T1', 'guide_S1PR2', 'guide_SAMD1', 'guide_SET', 'guide_SGK1', 'guide_SLC38A2', 'guide_SLC4A1', 'guide_SLC6A9', 'guide_SNAI1', 'guide_SPI1', 'guide_STIL', 'guide_TBX2', 'guide_TBX3', 'guide_TGFBR2', 'guide_TMSB4X', 'guide_TP73', 'guide_TSC22D1', 'guide_UBASH3A', 'guide_UBASH3B', 'guide_ZBTB1', 'guide_ZBTB10', 'guide_ZBTB25', 'guide_ZC3HAV1', 'guide_ZNF318', 'guide_ids', 'n_genes', 'n_genes_by_counts', 'total_counts', 'total_counts_mt', 'pct_counts_mt', 'leiden', 'perturbation_name', 'perturbation_type', 'perturbation_value', 'perturbation_unit'
    var: 'index', 'n_cells', 'mt', 'n_cells_by_counts', 'mean_counts', 'pct_dropout_by_counts', 'total_counts', 'highly_variable', 'means', 'dispersions', 'dispersions_norm', 'ensembl_id', 'ensembl_id_collapsed'
    uns: 'doi', 'hvg', 'leiden', 'neighbors', 'pca', 'preprocessing_nb_link', 'umap', 'log1p'
    obsm: 'X_pca', 'X_umap'
    varm: 'PCs'
    layers: 'counts'
    obsp: 'connectivities', 'distances' has no column attribute 'filter_pass'; tokenizing all cells.
[2025-12-17 21:08:18,756][helical.models.geneformer.geneformer_tokenizer][INFO] - Creating dataset.
[2025-12-17 21:08:18,773][helical.models.geneformer.model][INFO] - Successfully processed the data for Geneformer.
[2025-12-17 21:08:18,774][__main__][INFO] - Extracting embeddings...
[2025-12-17 21:08:18,774][helical.models.geneformer.model][INFO] - Started getting embeddings:
[2025-12-17 21:08:18,774][helical.models.geneformer.geneformer_utils][WARNING] - CLS token present in token dictionary, excluding from average.
[2025-12-17 21:08:18,774][helical.models.geneformer.geneformer_utils][WARNING] - EOS token present in token dictionary, excluding from average.
[2025-12-17 21:08:19,334][helical.models.geneformer.model][INFO] - Finished getting embeddings.
[2025-12-17 21:08:19,334][__main__][INFO] - Extracted embeddings shape: (1000, 512)
[2025-12-17 21:08:19,334][__main__][INFO] - Perturbation complete
[2025-12-17 21:08:19,358][__main__][INFO] - Saved outputs for baseline to outputs/outputs/baseline
[2025-12-17 21:08:19,367][__main__][INFO] - 
====================================================================================================
[2025-12-17 21:08:19,367][__main__][INFO] - Running with DISTRIBUTED optimization...
[2025-12-17 21:08:19,367][__main__][INFO] - Using 4 GPUs with DataParallel
[2025-12-17 21:08:19,369][__main__][INFO] - Extracting embeddings...
[2025-12-17 21:08:19,369][__main__][ERROR] - distributed failed: 'DataParallel' object has no attribute 'get_embeddings'
Traceback (most recent call last):
  File "/root/capsule/code/helical-challenge/main.py", line 1120, in run
    try:
  File "/root/capsule/code/helical-challenge/main.py", line 847, in run_with_distributed
  File "/root/capsule/code/helical-challenge/main.py", line 494, in extract_embeddings
    embeddings = model.get_embeddings(data)
  File "/opt/conda/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1940, in __getattr__
    raise AttributeError(
AttributeError: 'DataParallel' object has no attribute 'get_embeddings'
[2025-12-17 21:08:19,373][__main__][INFO] - 
====================================================================================================
[2025-12-17 21:08:19,374][__main__][INFO] - COMPARING OUTPUTS TO BASELINE
[2025-12-17 21:08:19,374][__main__][INFO] - ====================================================================================================
[2025-12-17 21:08:19,375][__main__][INFO] - Performance metrics saved to: outputs/performance_metrics_20251217_210819.csv
[2025-12-17 21:08:19,377][__main__][INFO] - 
====================================================================================================
[2025-12-17 21:08:19,377][__main__][INFO] - PERFORMANCE SUMMARY
[2025-12-17 21:08:19,377][__main__][INFO] - ====================================================================================================
[2025-12-17 21:08:19,380][__main__][INFO] - 
     method  runtime_seconds  cpu_percent    memory_mb  gpu_memory_mb  gpu_utilization  throughput_cells_per_sec  num_cells  num_genes_perturbed                   timestamp extra_optimization
0  baseline        12.716794         79.6  6004.730469     153.536621               40                 78.636169       1000                   10  2025-12-17T21:08:19.336199               none

[2025-12-17 21:08:19,380][__main__][INFO] - 
SPEEDUP RELATIVE TO BASELINE:
[2025-12-17 21:08:19,380][__main__][INFO] - --------------------------------------------------
[2025-12-17 21:08:19,381][__main__][INFO] - ====================================================================================================
[2025-12-17 21:08:19,381][__main__][INFO] - 
All outputs saved to: outputs
[2025-12-17 21:08:19,381][__main__][INFO] - 
====================================================================================================
[2025-12-17 21:08:19,381][__main__][INFO] - PIPELINE COMPLETE!
[2025-12-17 21:08:19,381][__main__][INFO] - ====================================================================================================
